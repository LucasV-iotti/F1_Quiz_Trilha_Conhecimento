<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>F1 Quiz – Trilha do Conhecimento</title>
<link href="style.css" rel="stylesheet"/>
<style>/* Fonte via CSS (não aparece como conteúdo) */
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap');

/* ===== Tema / Variáveis ===== */
:root{
  --bg: #0b0c10;
  --card: #15171c;
  --text: #e9edf1;
  --muted: #b2b8c2;
  --red: #e10600;
  --yellow: #ffdd00;
  --green: #2ecc71;

  --glass-bg: rgba(21,23,28,.5);
  --glass-brd: rgba(255,255,255,.12);
  --glow: 0 0 24px rgba(225,6,0,.25);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
  background: radial-gradient(1200px 600px at 110% -10%, #1b1f26 0%, var(--bg) 45%);
}

/* ===== Header ===== */
.app-header{
  position:sticky; top:0; z-index:5;
  background:linear-gradient(90deg,var(--card),transparent);
  padding:8px 16px; border-bottom:1px solid #23262c
}
.flag{
  height:12px;
  background:repeating-linear-gradient(45deg,#fff 0 10px,#000 10px 20px);
  filter:contrast(1.2); border-radius:2px; margin-bottom:6px
}
.brand{margin:0; font-weight:800; letter-spacing:.3px; display:flex; align-items:center; gap:.5rem}
.brand .car{display:inline-block; animation:car-move 5s linear infinite}
@keyframes car-move{from{transform:translateX(-10px)}to{transform:translateX(10px)}}

/* ===== Estrutura ===== */
main{max-width:1200px; margin:20px auto; padding:0 16px}
.screen{display:none; animation:fade .3s ease}
.screen.show{display:block}
@keyframes fade{from{opacity:0; transform:translateY(6px)}to{opacity:1; transform:translateY(0)}}

/* ===== Botões ===== */
.btn{
  appearance:none; border:none; border-radius:999px;
  padding:12px 18px; background:#2a2f37; color:var(--text);
  font-weight:600; cursor:pointer; transition:filter .2s, transform .02s, box-shadow .2s
}
.btn:hover{filter:brightness(1.05)}
.btn:active{transform:translateY(1px)}
.btn.primary{background:linear-gradient(90deg,var(--red),#ff3b30); box-shadow:var(--glow)}
.btn.secondary{background:linear-gradient(90deg,#0072ff,#00c6ff)}
.btn.ghost{background:transparent; border:1px solid #2a2f37}
.btn.xl{font-size:1.05rem; padding:14px 22px}
.btn.lg{font-size:1.0rem; padding:12px 20px}
.btn[disabled]{opacity:.5; cursor:not-allowed}

/* Luzes decorativas nos botões */
.btn .btn-lights{display:inline-flex; gap:4px; margin-right:8px; vertical-align:middle}
.btn .btn-lights i{
  width:10px; height:10px; border-radius:50%; background:#2b2b2b; display:inline-block; 
  box-shadow:inset 0 2px 5px rgba(0,0,0,.6); border:1px solid #000
}
.btn:hover .btn-lights i{
  background:#d40000; box-shadow:0 0 8px #ff1e1e, inset 0 6px 10px rgba(0,0,0,.6)
}

/* ===== Glass ===== */
.glass{
  background:var(--glass-bg);
  border:1px solid var(--glass-brd);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-radius:16px;
  box-shadow:0 16px 40px rgba(0,0,0,.25);
}

/* ===== TELA 1: HERO START ===== */
.hero{position:relative; overflow:hidden; border-radius:18px}
.hero-bg{
  position:absolute; inset:0;
  background:
    radial-gradient(1000px 400px at -10% 120%, rgba(225,6,0,.15), transparent 60%),
    radial-gradient(700px 300px at 110% -15%, rgba(0,114,255,.15), transparent 60%);
  pointer-events:none;
}
.start-grid{
  position:relative; display:grid; gap:18px; padding:22px;
  grid-template-columns: 1.1fr 1fr;
}
@media (max-width: 860px){ .start-grid{grid-template-columns:1fr} }
.hero-left{padding:14px 10px}
.hero-title{margin:0 0 8px; font-size:2rem; letter-spacing:.5px}
.hero-sub{margin:0; color:var(--muted); line-height:1.6}

.lights-preview{margin-top:14px}
.lights-preview .light{
  display:inline-block; width:18px; height:18px; border-radius:50%;
  background:#2b2b2b; border:2px solid #000; margin-right:6px;
  box-shadow: inset 0 4px 10px rgba(0,0,0,.6);
  animation:preview 1.2s infinite;
}
.lights-preview .light:nth-child(2){animation-delay:.15s}
.lights-preview .light:nth-child(3){animation-delay:.30s}
.lights-preview .light:nth-child(4){animation-delay:.45s}
.lights-preview .light:nth-child(5){animation-delay:.60s}
@keyframes preview{
  0%,60% { background:#2b2b2b; box-shadow: inset 0 4px 10px rgba(0,0,0,.6) }
  61%,100%{ background:#d40000; box-shadow: 0 0 12px #ff1e1e, inset 0 8px 12px rgba(0,0,0,.6) }
}

.form-card{padding:18px}
.card-title{margin:0 0 10px; font-weight:700}
.field{margin:12px 0}
label{display:block; margin:0 0 6px}
.input-wrap{position:relative}
input[type=text]{
  width:100%; padding:14px 44px 14px 12px; border:1px solid #2a2f37; border-radius:10px;
  background:#0f1116; color:var(--text); outline:none; transition:border-color .2s, box-shadow .2s
}
input[type=text]:focus{border-color:#3b4250; box-shadow:0 0 0 3px rgba(225,6,0,.15)}
.hint{color:var(--muted); font-size:.85rem}
.status{
  position:absolute; right:10px; top:50%; transform:translateY(-50%);
  width:20px; height:20px; border-radius:50%;
  background:#2b2b2b; border:1px solid #000; box-shadow: inset 0 2px 6px rgba(0,0,0,.6)
}
.status.ok{background:linear-gradient(180deg,#1bd97b,#0bbd62); box-shadow:0 0 10px rgba(27,217,123,.5)}
.status.no{background:linear-gradient(180deg,#ff5858,#e10600); box-shadow:0 0 10px rgba(225,6,0,.45)}

/* ===== TELA 2: REGRAS ===== */
.rules-wrap{padding:22px; margin:0 auto}
.section-title{margin:0 0 14px; font-size:1.6rem}
.rules-grid{
  display:grid; grid-template-columns:repeat(2,1fr); gap:14px; margin-bottom:10px
}
@media (max-width: 720px){ .rules-grid{grid-template-columns:1fr} }
.rule{
  display:flex; gap:12px; align-items:flex-start; background:rgba(0,0,0,.25);
  border:1px solid #2a2f37; border-radius:12px; padding:12px
}
.rule-icon{font-size:1.4rem; width:32px; height:32px; display:grid; place-items:center}
.rule-icon.green{color:#1bd97b}
.rule-icon.red{color:#ff5858}
.rule-text{line-height:1.6}
.badge{
  display:inline-block; padding:2px 8px; border-radius:999px; font-weight:700; font-size:.9rem
}
.badge.plus{background:rgba(27,217,123,.12); color:#1bd97b; border:1px solid rgba(27,217,123,.35)}
.badge.minus{background:rgba(225,6,0,.12); color:#ff5858; border:1px solid rgba(225,6,0,.35)}
.legend{display:flex; align-items:center; gap:8px; color:var(--muted); margin:10px 0 6px}
.legend .sep{opacity:.5}

/* ===== HUD (quiz) ===== */
.hud{
  display:grid; grid-template-columns:110px 1fr auto;
  gap:12px; align-items:center; margin-bottom:12px
}
.lap{
  background:#0f1116; border:1px solid #2a2f37;
  padding:8px 10px; border-radius:8px;
  color:var(--yellow); font-weight:700
}
.score{font-weight:700}

/* ===== Pista / Cenário ===== */
.track-wrap{
  position:relative;
  aspect-ratio: 21/9;   /* mais larga e mais baixa */
  width:100%;
  border:1px solid #23262c;
  border-radius:16px;
  overflow:hidden;
  background: radial-gradient(900px 400px at -10% 120%, #0c1018, #0a0c12 50%, #07090e 100%);
  box-shadow: 0 20px 50px rgba(0,0,0,.35) inset, 0 8px 30px rgba(0,0,0,.25);
  min-height: 260px;
}
.bg-parallax{position:absolute; inset:0; pointer-events:none; overflow:hidden}
.stands{
  position:absolute; inset:0 0 auto 0; height:24%;
  background:
    linear-gradient(to bottom, rgba(255,255,255,.05), rgba(0,0,0,.0)),
    repeating-linear-gradient(90deg, #1c2230 0 40px, #121722 40px 80px);
  filter:saturate(0.9) brightness(0.9);
}
.speedlines{
  position:absolute; inset:auto 0 0 0; height:26%;
  background: repeating-linear-gradient(135deg, rgba(255,255,255,.06) 0 6px, transparent 6px 30px);
  animation:speed 4s linear infinite;
  opacity:.35;
}
@keyframes speed{from{background-position:0 0} to{background-position:800px 0}}

.track{position:absolute; inset:0; width:100%; height:100%; z-index:1}

/* Luzes de Largada (overlay) */
.start-lights{
  position:absolute; inset:0;
  display:grid; place-items:center;
  background:rgba(0,0,0,.35);
  opacity:0; pointer-events:none; transition:opacity .2s ease;
  z-index:5;
}
.start-lights.active{opacity:1; pointer-events:auto;}
.start-lights .light{
  width:56px; height:56px; border-radius:50%; margin:6px; display:inline-block;
  background:#2b2b2b; box-shadow: inset 0 4px 10px rgba(0,0,0,.6);
  border:2px solid #000;
}
.start-lights .light.on{
  background:#d40000; box-shadow: 0 0 24px #ff1e1e, inset 0 8px 14px rgba(0,0,0,.6);
}
.start-lights .go{
  position:absolute; bottom:10%; font-weight:800; letter-spacing:2px;
  color:#00e676; font-size:40px; opacity:0; transform:scale(.9);
}

/* Card do Quiz no centro da pista */
.card{
  background:linear-gradient(180deg,#191c22,#10131a);
  border:1px solid #2a2f37; border-radius:16px; padding:20px;
  box-shadow:0 6px 20px rgba(0,0,0,.25);
  margin-top:12px;
  animation:slideIn .3s ease;
}
.card.on-track{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:min(92%, 560px);
  z-index:4; /* acima da pista e do carro */
}
@keyframes slideIn{from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)}}
.question{margin-top:0}
.options{display:grid; grid-template-columns:1fr; gap:10px; margin-top:12px}
@media (min-width:640px){.options{grid-template-columns:1fr 1fr}}
.option{
  display:block; width:100%; text-align:left; padding:14px 16px;
  border-radius:12px; border:1px solid #2a2f37; background:#0f1116; color:var(--text);
  cursor:pointer; transition:transform .06s, border-color .2s, background .2s
}
.option:hover{border-color:#3b4250; transform:translateY(-1px)}
.option:active{transform:translateY(1px)}
.option.correct{background:rgba(46,204,113,.16); border-color:#2ecc71}
.option.wrong{background:rgba(225,6,0,.12); border-color:var(--red)}

.feedback{min-height:28px; margin-top:10px; font-weight:700}
.feedback.ok{color:#2ecc71}
.feedback.no{color:#ff5858}

/* ===== Tela Final: Pódio + Medalha + Confete ===== */
.finish-hero{position:relative; overflow:hidden; border-radius:18px; padding:14px}
.finish-title{
  text-align:center; margin:0 0 10px;
  background: repeating-linear-gradient(45deg,#fff 0 12px,#000 12px 24px);
  -webkit-background-clip:text; background-clip:text; color:transparent;
  animation:flagWave 1.6s ease-in-out infinite alternate;
}
@keyframes flagWave{from{letter-spacing:1px} to{letter-spacing:3px}}

.podium{
  max-width:760px; margin:0 auto; padding:18px;
  display:grid; gap:12px;
}
.summary{display:flex; gap:16px; flex-wrap:wrap; color:var(--muted)}
.stats{display:flex; gap:10px; flex-wrap:wrap}
.chip{
  background:#0f1116; border:1px solid #2a2f37; border-radius:999px;
  padding:8px 12px; font-weight:600
}
.chip.ok{color:#1bd97b; border-color:rgba(27,217,123,.4); background:rgba(27,217,123,.08)}
.chip.no{color:#ff5858; border-color:rgba(225,6,0,.4); background:rgba(225,6,0,.08)}
.badge.msg{margin-top:6px}

.medal{
  width:82px; height:82px; border-radius:50%; margin:6px auto 2px;
  display:grid; place-items:center; font-size:2rem; font-weight:800;
  border:2px solid rgba(255,255,255,.2);
  box-shadow:0 12px 30px rgba(0,0,0,.35), inset 0 8px 16px rgba(255,255,255,.08);
}
.medal.gold{ background: radial-gradient(circle at 30% 30%, #fff5b8, #f3c301 60%, #9b6b00 100%); }
.medal.silver{ background: radial-gradient(circle at 30% 30%, #f5f7fa, #c2c8d0 60%, #7e8791 100%); }
.medal.bronze{ background: radial-gradient(circle at 30% 30%, #ffe0c2, #c47c31 60%, #7a4b1e 100%); }

/* Confete */
.confetti{position:absolute; inset:0; pointer-events:none; overflow:hidden}
.confetti .piece{
  position:absolute; width:10px; height:16px; opacity:.9;
  animation:fall linear forwards, spin linear infinite;
}
@keyframes fall{
  to { transform: translateY(110vh) rotate(0deg); opacity:.98; }
}
@keyframes spin{
  from{ transform: translateY(-10vh) rotate(0deg); }
  to  { transform: translateY(110vh) rotate(720deg); }
}

/* ===== Acessibilidade – menos movimento ===== */
@media (prefers-reduced-motion: reduce){
  .brand .car, .speedlines, .lights-preview .light, .finish-title {animation:none}
  .screen{animation:none}
}

/* ===== Responsividade ===== */
@media (max-width: 420px){
  .card.on-track{ width:94%; }
}
</style></head>
<body>
<header class="app-header">
<div class="flag"></div>
<h1 class="brand"><span aria-hidden="" class="car">🏎️</span> F1 Quiz – Trilha do Conhecimento</h1>
</header>
<main>
<!-- TELA 1: NOME E CPF -->
<section class="screen show" id="screen-start">
<div class="hero">
<div class="hero-bg"></div>
<div class="start-grid">
<div class="hero-left">
<h2 class="hero-title">Hora da Largada</h2>
<p class="hero-sub">Entre no cockpit, ajuste o cinto e <strong>prepare-se para acelerar</strong> no conhecimento!</p>
<div aria-hidden="true" class="lights-preview">
<span class="light"></span><span class="light"></span><span class="light"></span><span class="light"></span><span class="light"></span>
</div>
</div>
<div class="form-card glass">
<h3 class="card-title">Identificação do Piloto</h3>
<form autocomplete="on" id="start-form" novalidate="">
<div class="field">
<label for="playerName">Nome</label>
<div class="input-wrap">
<input id="playerName" name="playerName" placeholder="Seu nome" required="" type="text"/>
<span aria-hidden="true" class="status" id="nameStatus"></span>
</div>
<small class="hint">Mínimo de 2 caracteres.</small>
</div>
<div class="field">
<label for="playerCPF">CPF</label>
<div class="input-wrap">
<input id="playerCPF" inputmode="numeric" maxlength="14" name="playerCPF" placeholder="000.000.000-00" required="" type="text"/>
<span aria-hidden="true" class="status" id="cpfStatus"></span>
</div>
<small class="hint">Formato: 000.000.000-00 (validação automática).</small>
</div>
<button class="btn primary xl" disabled="" id="btnStart" type="button">
<span class="btn-lights"><i></i><i></i><i></i><i></i><i></i></span>
                Iniciar Largada
              </button>
</form>
</div>
</div>
</div>
</section>
<!-- TELA 2: REGRAS -->
<section class="screen" id="screen-rules">
<div class="rules-wrap glass">
<h2 class="section-title">Pit Stop: Regras da Corrida</h2>
<div class="rules-grid">
<article class="rule">
<div class="rule-icon">🏁</div>
<div class="rule-text">
              10 perguntas. Uma volta por pergunta. Complete o circuito com o melhor desempenho.
            </div>
</article>
<article class="rule">
<div class="rule-icon green">✅</div>
<div class="rule-text">
              Acertou? <span class="badge plus">+10 pts</span> – seu carro ganha impulso!
            </div>
</article>
<article class="rule">
<div class="rule-icon red">⚠️</div>
<div class="rule-text">
              Errou? <span class="badge minus">−5 pts</span> – hora de um pit stop mental.
            </div>
</article>
<article class="rule">
<div class="rule-icon">⏩</div>
<div class="rule-text">
              Ao escolher, você recebe feedback e <strong>avança automaticamente</strong> para a próxima volta.
            </div>
</article>
<article class="rule">
<div class="rule-icon">📊</div>
<div class="rule-text">
              No final, exibimos <strong>pontuação, acertos e erros</strong> com sua medalha no pódio.
            </div>
</article>
</div>
<div class="legend">
<span class="badge plus">+10</span> <span>Acerto</span>
<span class="sep">•</span>
<span class="badge minus">−5</span> <span>Erro</span>
</div>
<button class="btn secondary lg" id="btnGoQuiz">
<span class="btn-lights"><i></i><i></i><i></i><i></i><i></i></span>
          Começar a Corrida
        </button>
</div>
</section>
<!-- TELA 3+: QUIZ COM PISTA -->
<section class="screen" id="screen-quiz">
<div class="hud">
<div class="lap"><span id="lapNow">1</span>/<span id="lapTotal">10</span> voltas</div>
<div class="score">Pontuação: <strong id="score">0</strong></div>
</div>
<div class="track-wrap">
<!-- Parallax -->
<div class="bg-parallax">
<div class="stands"></div>
<div class="speedlines"></div>
</div>
<!-- PISTA -->
<svg aria-label="Pista de corrida" class="track" preserveaspectratio="xMidYMid meet" viewbox="0 0 1000 430">
<defs>
<pattern height="10" id="checkers" patternunits="userSpaceOnUse" width="10">
<rect fill="#fff" height="10" width="10"></rect>
<rect fill="#000" height="5" width="5"></rect>
<rect fill="#000" height="5" width="5" x="5" y="5"></rect>
</pattern>
<path d="M180,70 h640 a70,70 0 0 1 70,70 v150 a70,70 0 0 1 -70,70 h-640 a70,70 0 0 1 -70,-70 v-150 a70,70 0 0 1 70,-70 z" id="route"></path>
</defs>
<!-- Asfalto e bordas -->
<use fill="none" href="#route" stroke="#0f1116" stroke-linecap="round" stroke-width="86"></use>
<use fill="none" href="#route" stroke="#2a2f37" stroke-linecap="round" stroke-width="34"></use>
<use fill="none" href="#route" stroke="rgba(255,255,255,.08)" stroke-dasharray="24 16" stroke-width="10"></use>
<!-- Largada/Chegada -->
<rect fill="url(#checkers)" height="50" width="18" x="180" y="200"></rect>
<!-- Carro no traçado -->
<g class="race-car-svg" id="raceCar" transform="translate(180,70)">
<g id="carIcon">
<rect fill="#1e232b" height="14" rx="2" width="8" x="-24" y="-7"></rect>
<rect fill="#1e232b" height="14" rx="2" width="8" x="16" y="-7"></rect>
<rect fill="#e10600" height="16" rx="6" width="36" x="-18" y="-8"></rect>
<rect fill="#292f3a" height="12" rx="3" width="12" x="-6" y="-6"></rect>
<polygon fill="#ff4d3d" points="18,-8 28,0 18,8"></polygon>
</g>
</g>
</svg>
<!-- Luzes de Largada -->
<div aria-hidden="true" class="start-lights" id="startLights">
<div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
<div class="go">GO!</div>
</div>
<!-- Card do Quiz no centro -->
<div class="card on-track">
<h3 class="question" id="questionText">…</h3>
<div class="options" id="options"></div>
<div aria-live="polite" class="feedback" id="feedback"></div>
</div>
</div>
</section>
<!-- TELA FINAL -->
<section class="screen" id="screen-result">
<div class="finish-hero">
<h2 class="finish-title">🏁 Bandeirada Final</h2>
<div class="podium glass">
<div class="medal" id="medal"></div>
<div class="summary">
<p><strong>Piloto:</strong> <span id="outName">—</span></p>
<p><strong>CPF:</strong> <span id="outCPF">—</span></p>
</div>
<div class="stats">
<div class="chip">Pontuação: <strong id="outScore">0</strong> pts</div>
<div class="chip ok">Acertos: <strong id="outHits">0</strong></div>
<div class="chip no">Erros: <strong id="outMiss">0</strong></div>
</div>
<p class="badge msg" id="outBadge"></p>
<div class="actions">
<button class="btn ghost" id="btnRestart">Jogar novamente</button>
</div>
</div>
<!-- Confete -->
<div aria-hidden="true" class="confetti" id="confetti"></div>
</div>
</section>
</main>
<script src="script.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const supabaseUrl = 'https://phmpoizlkrwzouydkopp.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBobXBvaXpsa3J3em91eWRrb3BwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxNDExOTMsImV4cCI6MjA3MTcxNzE5M30.fcbEM3ekrx6UP-MPWA7xqLzvxPihzEJQhCQxEKt1Qf0';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  async function verificarConexaoSupabase() {
    try {
      const { error } = await supabase.from('Quiz F1 Trilha do Conhecimento').select('*').limit(1);
      const statusEl = document.createElement('div');
      statusEl.textContent = error ? 'Supabase: OFFLINE' : 'Supabase: ONLINE';
      statusEl.style.position = 'fixed';
      statusEl.style.top = '10px';
      statusEl.style.right = '10px';
      statusEl.style.padding = '6px 12px';
      statusEl.style.background = error ? '#e10600' : '#2ecc71';
      statusEl.style.color = '#fff';
      statusEl.style.fontWeight = 'bold';
      statusEl.style.borderRadius = '6px';
      statusEl.style.zIndex = '9999';
      document.body.appendChild(statusEl);
    } catch (e) {
      console.error('Erro ao verificar Supabase:', e);
    }
  }

  document.addEventListener('DOMContentLoaded', verificarConexaoSupabase);
</script>
<script>// F1 Quiz – telas turbinadas + pista larga/baixa + carro no traçado central do SVG
const $  = (sel) => document.querySelector(sel);
const $$ = (sel) => document.querySelectorAll(sel);

/* ===== Estado do jogo ===== */
let state = {
  playerName: '',
  cpf: '',
  score: 0,
  current: 0,
  hits: 0,
  miss: 0,
};

/* ===== Perguntas (do seu arquivo) ===== */
const questions = [
  { q:'1. Qual é um dos principais riscos do uso do cartão de crédito?', options:['A) Não poder parcelar compras','B) Entrar no crédito rotativo com juros altos','C) Não ter limite para compras','D) Não poder usar em compras online'], answer:1 },
  { q:'2. O cheque especial é um tipo de crédito ________ oferecido pelo banco, ligado diretamente à conta corrente.', options:['A) parcelado','B) automático','C) garantido','D) consignado'], answer:1 },
  { q:'3. Qual é um benefício do empréstimo pessoal?', options:['A) Não pagar juros','B) Parcelas variáveis','C) Dinheiro rápido para emergências','D) Não comprometer a renda mensal'], answer:2 },
  { q:'4. Quando o cliente atrasa o pagamento, além dos juros, multa e encargos, o ________ é reduzido.', options:['A) limite do cartão','B) score de crédito','C) valor da fatura','D) prazo de pagamento'], answer:1 },
  { q:'5. Qual é a consequência de usar o cheque especial com frequência?', options:['A) Aumento do limite','B) Redução dos juros','C) Endividamento por juros altos','D) Isenção de tarifas'], answer:2 },
  { q:'6. Se a fatura do cartão é de R$ 1.000 e o cliente paga apenas R$ 100, os R$ 900 restantes entram no ________.', options:['A) parcelamento sem juros','B) crédito rotativo','C) cheque especial','D) limite adicional'], answer:1 },
  { q:'7. Qual é a principal vantagem de pagar a fatura do cartão de crédito em dia e integralmente?', options:['A) Aumentar os juros','B) Evitar o crédito rotativo','C) Reduzir o limite','D) Cancelar o cartão'], answer:1 },
  { q:'8. O empréstimo pessoal geralmente não exige ________ como garantia.', options:['A) imóvel','B) análise de crédito','C) contrato','D) parcelas fixas'], answer:0 },
  { q:'9. Qual é a conta mais frequente em atraso que leva à inadimplência no Brasil?', options:['A) Empréstimos','B) Cartão de crédito','C) Cheque especial','D) Telefone'], answer:1 },
  { q:'10. Mesmo após pagar a dívida, o cliente pode ter dificuldade para conseguir crédito devido ao ________.', options:['A) aumento do limite','B) histórico negativo','C) cancelamento do contrato','D) falta de cadastro'], answer:1 },
];

/* ===== Utilidades ===== */
function maskCPF(value){
  return value.replace(/\D/g,'').slice(0,11)
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d{1,2})$/,'$1-$2');
}
function isValidCPF(cpf){
  cpf = cpf.replace(/\D/g,'');
  if (!cpf || cpf.length !== 11) return false;
  if (/^(\d)\1+$/.test(cpf)) return false;
  let soma=0, resto;
  for (let i=1;i<=9;i++) soma += parseInt(cpf.substring(i-1,i))*(11-i);
  resto = (soma*10)%11; if (resto===10||resto===11) resto=0;
  if (resto!==parseInt(cpf.substring(9,10))) return false;
  soma=0;
  for (let i=1;i<=10;i++) soma += parseInt(cpf.substring(i-1,i))*(12-i);
  resto = (soma*10)%11; if (resto===10||resto===11) resto=0;
  if (resto!==parseInt(cpf.substring(10,11))) return false;
  return true;
}
function showScreen(id){
  $$('.screen').forEach(s=>s.classList.remove('show'));
  $(id).classList.add('show');
}
function updateHUD(){
  $('#lapNow').textContent = Math.min(state.current + 1, questions.length);
  $('#lapTotal').textContent = String(questions.length);
  $('#score').textContent = state.score;
}

/* ===== Carro no traçado central do SVG ===== */
let routePath, totalLen, raceCar;
function initTrackRefs(){
  routePath = document.querySelector('#route');
  raceCar   = document.querySelector('#raceCar');
  if (routePath) totalLen = routePath.getTotalLength();
}
function placeCarByProgress(progress){ // progress: 0..1
  if (!routePath || !raceCar) return;
  const len = totalLen * progress;
  const p   = routePath.getPointAtLength(len);
  const p2  = routePath.getPointAtLength(Math.min(totalLen, len + 1));
  const angle = Math.atan2(p2.y - p.y, p2.x - p.x) * 180 / Math.PI;

  raceCar.setAttribute('transform', `translate(${p.x},${p.y}) rotate(${angle})`);
}
function updateCarProgress(){
  const t = state.current / questions.length;
  placeCarByProgress(t);
}

/* ===== Renderização ===== */
function renderQuestion(){
  const q = questions[state.current];
  $('#questionText').textContent = q.q;
  const cont = $('#options');
  cont.innerHTML = '';
  q.options.forEach((opt, idx)=>{
    const btn = document.createElement('button');
    btn.className = 'option';
    btn.textContent = opt;
    btn.addEventListener('click', ()=> handleAnswer(idx, btn));
    cont.appendChild(btn);
  });
  $('#feedback').textContent = '';
  updateHUD();
  updateCarProgress();
}

function handleAnswer(idx, el){
  const q = questions[state.current];
  const isCorrect = idx === q.answer;

  if (isCorrect){
    state.score += 10; state.hits += 1;
    $('#feedback').textContent = '✔ Resposta correta! +10 pontos';
    $('#feedback').className = 'feedback ok';
    el.classList.add('correct');
  } else {
    state.score -= 5; state.miss += 1;
    $('#feedback').textContent = '✖ Resposta incorreta! −5 pontos';
    $('#feedback').className = 'feedback no';
    el.classList.add('wrong');
    // destaca também a correta
    const buttons = $$('.option');
    if (buttons[q.answer]) buttons[q.answer].classList.add('correct');
  }

  // bloqueia múltiplos cliques
  $$('.option').forEach(b=> b.disabled = true);

  // avança
  setTimeout(()=>{
    state.current += 1;
    if (state.current >= questions.length){
      finish();
    } else {
      renderQuestion();
    }
  }, 900);
}

/* ===== Tela Final ===== */
function finish(){
  updateCarProgress(); // garante posição final

  $('#outName').textContent = state.playerName;
  $('#outCPF').textContent  = state.cpf;
  $('#outScore').textContent= state.score;
  $('#outHits').textContent = state.hits;
  $('#outMiss').textContent = state.miss;

  const badge = $('#outBadge');
  const medal = $('#medal');
  medal.className = 'medal';

  if (state.score >= 90){
    badge.textContent = '🏆 Campeão da pista! Performance de elite.';
    medal.classList.add('gold');  medal.textContent = '🥇';
  } else if (state.score >= 60){
    badge.textContent = '🥈 Ótima corrida! Você mandou muito bem.';
    medal.classList.add('silver'); medal.textContent = '🥈';
  } else if (state.score >= 30){
    badge.textContent = '🥉 Boa prova! Ainda dá para ganhar ritmo.';
    medal.classList.add('bronze'); medal.textContent = '🥉';
  } else {
    badge.textContent = '🧰 Hora de um pit stop nos estudos. Você chega lá!';
    medal.textContent = '🏁';
  }

  showScreen('#screen-result');
  launchConfetti(); // celebração
}

/* ===== Largada (start lights) ===== */
async function startSequenceThenBegin(){
  showScreen('#screen-quiz');
  initTrackRefs();          // garante refs do SVG no momento da tela
  placeCarByProgress(0);    // posiciona na linha de largada

  const overlay = $('#startLights');
  overlay.classList.add('active');
  const lights = overlay.querySelectorAll('.light');
  const go = overlay.querySelector('.go');

  // acende 5 luzes
  for (let i=0; i<lights.length; i++){
    await wait(600);
    lights[i].classList.add('on');
  }
  // apaga tudo + mostra GO
  await wait(500);
  lights.forEach(l=> l.classList.remove('on'));
  go.style.opacity = '1';
  go.style.transform = 'scale(1)';
  await wait(450);
  overlay.classList.remove('active');
  go.style.opacity = '0';

  // inicia a corrida
  renderQuestion();
}
function wait(ms){ return new Promise(res=> setTimeout(res, ms)); }

/* ===== Confete ===== */
function launchConfetti(){
  const container = $('#confetti');
  container.innerHTML = '';
  const colors = ['#ff3b30','#ffdd00','#2ecc71','#00c6ff','#ffffff'];

  const pieces = 120;
  for (let i=0; i<pieces; i++){
    const el = document.createElement('div');
    el.className = 'piece';
    const size = 6 + Math.random()*10;
    el.style.width  = size + 'px';
    el.style.height = (size*1.6) + 'px';
    el.style.left   = (Math.random()*100) + 'vw';
    el.style.top    = (-10 + Math.random()*10) + 'vh';
    el.style.background = colors[i % colors.length];
    el.style.animationDuration = (4 + Math.random()*3) + 's';
    el.style.animationDelay    = (Math.random()*0.5) + 's';
    el.style.transform = `translateY(-10vh) rotate(${Math.random()*360}deg)`;
    container.appendChild(el);
  }
  // remove depois de um tempo
  setTimeout(()=> container.innerHTML = '', 8000);
}

/* ===== Reset ===== */
function resetGame(){
  state = { playerName:'', cpf:'', score:0, current:0, hits:0, miss:0 };
  $('#playerName').value = '';
  $('#playerCPF').value  = '';
  $('#btnStart').disabled= true;
  $('#nameStatus').className = 'status';
  $('#cpfStatus').className  = 'status';
  showScreen('#screen-start');
}

/* ===== Inicialização & Eventos ===== */
window.addEventListener('DOMContentLoaded', ()=>{
  const nameInput = $('#playerName');
  const cpfInput  = $('#playerCPF');
  const btnStart  = $('#btnStart');

  function checkReady(){
    const okName = nameInput.value.trim().length >= 2;
    const masked = maskCPF(cpfInput.value);
    if (cpfInput.value !== masked) cpfInput.value = masked;
    const okCPF  = isValidCPF(masked);

    btnStart.disabled = !(okName && okCPF);

    // status visuais
    $('#nameStatus').className = 'status ' + (okName ? 'ok':'no');
    $('#cpfStatus').className  = 'status ' + (okCPF  ? 'ok':'no');
  }

  nameInput.addEventListener('input', checkReady);
  cpfInput .addEventListener('input', checkReady);

  btnStart.addEventListener('click', ()=>{
    state.playerName = nameInput.value.trim();
    state.cpf        = cpfInput.value;
    showScreen('#screen-rules');
  });

  $('#btnGoQuiz').addEventListener('click', ()=>{
    // zera estado e começa sequência de largada
    state.score = 0; state.current = 0; state.hits = 0; state.miss = 0;
    startSequenceThenBegin();
  });

  $('#btnRestart').addEventListener('click', resetGame);

  // Reposiciona o carro ao redimensionar
  window.addEventListener('resize', ()=>{
    if (document.querySelector('#screen-quiz').classList.contains('show')){
      initTrackRefs();
      updateCarProgress();
    }
  }, {passive:true});
});
</script></body>
</html>
